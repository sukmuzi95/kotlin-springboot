<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kotlinspringbootboard.mapper.BoardMapper">

    <insert id="insert" parameterType="com.example.kotlinspringbootboard.dto.BoardRequestDto">
        INSERT INTO TB_BOARD(BOARD_TITLE, BOARD_CONTENT, REGISTER_ID)
        VALUES (#{title}, #{content, jdbcType=VARCHAR}, (SELECT USER_NO FROM TB_USER WHERE USER_NAME = #{registerId}))
    </insert>

    <select id="findAll" resultType="com.example.kotlinspringbootboard.dto.BoardResponseDto">
        SELECT BOARD_NO, BOARD_TITLE, BOARD_CONTENT, B.USER_NAME, READ_COUNT, A.REGISTER_TIME, A.UPDATE_TIME
        FROM TB_BOARD A
        INNER JOIN TB_USER B ON A.REGISTER_ID = B.USER_NO
    </select>

    <select id="findById" resultType="com.example.kotlinspringbootboard.dto.BoardResponseDto">
        SELECT BOARD_NO, BOARD_TITLE, BOARD_CONTENT, B.USER_NAME, READ_COUNT, A.REGISTER_TIME, A.UPDATE_TIME
        FROM TB_BOARD A
        INNER JOIN TB_USER B ON A.REGISTER_ID = B.USER_NO
        WHERE A.BOARD_NO = #{no}
    </select>

    <update id="update" parameterType="com.example.kotlinspringbootboard.dto.BoardRequestDto">
        UPDATE TB_BOARD
        SET BOARD_TITLE = #{title}, BOARD_CONTENT = #{content, jdbcType=VARCHAR}, UPDATE_TIME = GETDATE()
        WHERE BOARD_NO = #{no}
    </update>
</mapper>